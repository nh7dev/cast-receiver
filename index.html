<!DOCTYPE html>
<html lang="en">

<head>
    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>

    <!-- https://developers.google.com/cast/docs/web_receiver/customize_ui -->
    <style>
        cast-media-player {
            --progress-color: rgb(120, 0, 46);

            --splash-image: url("loader.svg");

            --slideshow-image-1: url("loaders/audio.svg");
            --slideshow-image-2: url("loaders/ball-triangle.svg");
            --slideshow-image-3: url("loaders/bars.svg");
            --slideshow-image-4: url("loaders/circles.svg");
            --slideshow-image-5: url("loaders/grid.svg");
        }
    </style>
</head>

<body>

<cast-media-player></cast-media-player>

<!-- https://developers.google.com/cast/docs/reference/web_receiver -->
<script>
    console.log("started 5.0");

    //=====[context]=====

    const context = cast.framework.CastReceiverContext.getInstance();

    console.log(context.getDeviceCapabilities());

    //system error listener
    context.addEventListener(cast.framework.system.EventType.ERROR, event => {
            console.log("system error:");
            console.log(event);
        }
    );

    /*
    //message channel
    const channel = "urn:x-cast:streamcast";
    context.addCustomMessageListener(channel, event => {
            console.log("received custom message: " + event);
            let data = event.data;
            let message = data.message;
            console.log("received message: " + message);
        }
    );
    */

    //=====[player]=====

    const playerManager = context.getPlayerManager();

    //player error listener
    playerManager.addEventListener(cast.framework.events.EventType.ERROR, event => {
            console.log("player error:");
            console.log(event);
        }
    );

    /*
    //player debug listener
    playerManager.addEventListener(cast.framework.events.EventType.ALL, event => {
            console.log("player debug:");
            console.log(event);
        }
    );
    */

    //player video interceptor
    playerManager.setMessageInterceptor(cast.framework.messages.MessageType.PRELOAD, requestData => {
            console.log("loaded " + requestData.media.contentId + " with type " + requestData.media.contentType);
            console.log(requestData.media);
            console.log(requestData.customData);
            setPlaybackConfig("https://test.com")
            return requestData;
        }
    );

    const pc = new cast.framework.PlaybackConfig();
    pc.manifestRequestHandler = requestInfo => {
        requestInfo.headers = {Referer: "http://example.com"}
    };

    context.start({playbackConfig: pc});
    console.log("ready")

    function setPlaybackConfig(referer) {
        const playbackConfig = new cast.framework.PlaybackConfig();
        playbackConfig.manifestRequestHandler = requestInfo => {
            requestInfo.headers = {Referer: referer}
        };
        playerManager.setPlaybackConfig(playbackConfig);
        console.log("playbackconfig set: " + playbackConfig)
    }
</script>

</body>

</html>
